import{i as H,c,a as _,p as b,d as r,q as u,F as x,l as B,f as L,o as a,w as A,b as o,s as D,t as i}from"./index-CPnQyNTi.js";import{u as N}from"./history-DBcdZVCt.js";import{_ as I}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as l}from"./function-call-Be3urBny.js";import"./mount-component-DwzMd02N.js";const S={class:"history-container"},T={key:0,class:"history-list"},V={class:"news-item"},$={key:0,class:"news-image"},F=["src","alt"],P={class:"news-info"},R={class:"news-title"},q={class:"news-meta"},z={__name:"History",setup(E){const d=L(),n=N(),m=()=>{d.back()},p=t=>{d.push(`/news/detail/${t}`)},y=async t=>{try{const s=await n.removeHistoryApi(t);console.log("删除单条历史记录结果:",s),!s.success&&!s.isLocal&&l({title:"提示",message:s.message||"删除失败，请稍后重试"})}catch(s){console.error("删除历史记录失败:",s)}},h=t=>{l({title:"提示",message:"确定要删除这条浏览记录吗？",showCancelButton:!0}).then(s=>{s==="confirm"&&y(t)})},f=async()=>{l({title:"提示",message:"确定要清空所有浏览历史吗？",showCancelButton:!0}).then(async t=>{if(t==="confirm")try{const s=await n.clearHistoryApi();console.log("清空历史记录结果:",s),!s.success&&!s.isLocal&&l({title:"提示",message:s.message||"清空失败，请稍后重试"})}catch(s){console.error("清空历史记录失败:",s)}})};return H(async()=>{try{const t=await n.getHistoryListApi();console.log("浏览历史页面：API获取结果",t),(!t||!t.success)&&n.loadHistory()}catch(t){console.error("浏览历史页面：API请求异常",t),n.loadHistory()}}),(t,s)=>{const v=r("van-nav-bar"),g=r("van-cell"),w=r("van-button"),k=r("van-empty");return a(),c("div",S,[_(v,{title:"浏览历史","left-text":"返回","left-arrow":"",onClickLeft:m,"right-text":"清空",onClickRight:f,fixed:""}),u(n).getHistory.length?(a(),c("div",T,[(a(!0),c(x,null,B(u(n).getHistory,e=>(a(),c("div",{class:"history-item",key:e.id},[_(g,{onClick:C=>p(e.id),border:!1},{title:A(()=>[o("div",V,[e.image?(a(),c("div",$,[o("img",{src:e.image,alt:e.title},null,8,F)])):D("",!0),o("div",P,[o("div",R,i(e.title),1),o("div",q,[o("span",null,i(e.author),1),o("span",null,i(e.publishTime),1),o("span",null,"浏览时间: "+i(e.viewTime),1)])])])]),_:2},1032,["onClick"]),_(w,{class:"delete-btn",type:"danger",size:"mini",icon:"cross",onClick:C=>h(e.id)},null,8,["onClick"])]))),128))])):(a(),b(k,{key:1,description:"暂无浏览历史"}))])}}},O=I(z,[["__scopeId","data-v-5af02ed7"]]);export{O as default};
