import{u as B,j as _,n as I,i as P,c as n,a as g,p as R,d as v,q as o,b as s,s as h,t as r,v as T,F as D,l as k,f as V,o as a}from"./index-CPnQyNTi.js";import{u as H}from"./news-BAoQvu9z.js";import{u as $}from"./history-DBcdZVCt.js";import{u as j}from"./favorite-arX0ddpb.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as c}from"./function-call-B6h5_xHM.js";import"./mount-component-DwzMd02N.js";const z={class:"news-detail"},E={key:0,class:"detail-content"},M={class:"title-container"},U={class:"title"},G={class:"info"},J={key:0,class:"cover"},K=["src","alt"],O={class:"content"},Q={key:1,class:"related-news"},W={class:"related-list"},X=["onClick"],Y={class:"related-image"},Z=["src","alt"],ee={class:"related-title"},te={__name:"NewsDetail",setup(se){const y=I(),d=V(),e=H(),F=$(),i=j(),u=B(),m=_(()=>Number(y.params.id)),b=_(()=>e.newsDetail.content?e.newsDetail.content.split(`

`).filter(t=>t.trim()):[]),S=()=>{d.back()},N=t=>{d.push(`/news/detail/${t}`)},p=_(()=>i.isFavorite(m.value)),C=async()=>{if(!u.getLoginStatus){c({message:"请先登录后再收藏",position:"bottom"}),d.push("/login");return}const t=await i.toggleFavorite(e.newsDetail);t===!0?c({message:"已添加到收藏",position:"bottom"}):t===!1?c({message:"已取消收藏",position:"bottom"}):c({message:"操作失败，请稍后重试",position:"bottom"})};return P(async()=>{if(await e.getNewsDetail(m.value),e.newsDetail.id&&u.getLoginStatus)try{const t=await F.addHistoryApi(e.newsDetail.id);console.log("记录浏览历史API结果:",t)}catch(t){console.error("记录浏览历史API失败:",t)}if(i.loadFavorites(),u.getLoginStatus&&e.newsDetail.id){const t=await i.checkFavoriteStatusApi(e.newsDetail.id);t.success&&!t.isLocal&&(t.isFavorite&&!i.isFavorite(e.newsDetail.id)?i.addFavorite(e.newsDetail):!t.isFavorite&&i.isFavorite(e.newsDetail.id)&&i.removeFavorite(e.newsDetail.id))}}),(t,w)=>{const L=v("van-nav-bar"),x=v("van-button"),A=v("van-empty");return a(),n("div",z,[g(L,{title:"新闻详情","left-text":"返回","left-arrow":"",onClickLeft:S,fixed:""}),o(e).newsDetail.id?(a(),n("div",E,[s("div",M,[s("h1",U,r(o(e).newsDetail.title),1),g(x,{class:T(["favorite-btn",{"is-favorite":p.value}]),icon:p.value?"star":"star-o",onClick:C},null,8,["icon","class"])]),s("div",G,[s("span",null,r(o(e).newsDetail.author),1),s("span",null,r(o(e).newsDetail.publishTime),1),s("span",null,r(o(e).newsDetail.views)+" 阅读",1)]),o(e).newsDetail.image?(a(),n("div",J,[s("img",{src:o(e).newsDetail.image,alt:o(e).newsDetail.title},null,8,K)])):h("",!0),s("div",O,[(a(!0),n(D,null,k(b.value,(l,f)=>(a(),n("p",{key:f},r(l),1))),128))]),o(e).newsDetail.relatedNews?.length?(a(),n("div",Q,[w[0]||(w[0]=s("h3",null,"相关推荐",-1)),s("div",W,[(a(!0),n(D,null,k(o(e).newsDetail.relatedNews,l=>(a(),n("div",{class:"related-item",key:l.id,onClick:f=>N(l.id)},[s("div",Y,[s("img",{src:l.image,alt:l.title},null,8,Z)]),s("div",ee,r(l.title),1)],8,X))),128))])])):h("",!0)])):(a(),R(A,{key:1,description:"加载中..."}))])}}},de=q(te,[["__scopeId","data-v-e687bd09"]]);export{de as default};
